# IPSEC

## IPSec란?

- IPSec은 네트워크에서의 안전한 연결을 설정하기 위한 통신 규칙 또는 프로토콜 세트
- 인터넷 프로토콜(IP)은 데이터가 인터넷에서 전송되는 방식을 결정하는 공통 표준
    - IPSec는 암호화와 인증을 추가하여 프로토콜을 더욱 안전하게 만듬
- ex) IPSec는 데이터를 소스에서 암호화한 다음 대상에서 복호화 + 데이터 소스를 인증

## IPSec이 중요한 이유

- Internet Engineering Task Force는 퍼블릭 네트워크에 액세스할 때 데이터의 기밀성, 무결성, 및 신뢰성을 보장하기 위해 1990년대에 IPSec를 개발함
- IPSec 프로토콜은 중요한 정보를 암호화하여 원치 않는 모니터링을 방지
- 추가적으로 서버는 수신된 데이터 패킷이 인증되었는지 확인할 수 있음

## IPSec이 사용되는 곳

- Public 네트워크에서 데이터를 전송할 때 라우터 보안을 제공
- 애플리케이션 데이터 암호화
- 알려진 발신자가 보낸 데이터를 빠르게 인증
- 드 엔드포인트 간에 전송되는 모든 데이터를 암호화하는, IPSec 터널이라는 암호화된 회로를 설정하여 네트워크 데이터를 보호
    - 조직은 IPSec를 이용해 리플레이 공격으로부터 데이터를 보호
    
    > 리플레이 공격 또는 중간자(MITM) 공격 - 중간 컴퓨터로 데이터를 라우팅하여 진행중인 전송을 가로채고 변경하는 공격방법
    > 
    - IPSec 프로토콜은 각 데이터 패킷에 순차적 번호를 할당하고 검사를 수행하여 중복 패킷의 징후를 탐지

## IPSec 암호화란?

- IPSec 암호화는 데이터를 스크램블하여 권한이 없는 당사자로부터 콘텐츠를 보호하는 소프트웨어 기능
- 데이터는 암호화 키로 암호화되며, 정보의 스크램블을 해제하려면 복호화키가 필요
- IPSec은 AES, Blowfish, Triple DES, ChaCha, DES-CBC 등 다양한 암호화 유형을 지원
- IPSec은 비대칭 및 대칭 암호화를 사용해 데이터 전송중 빠른 속도와 보안을 제공
    - 비대칭 암호화에서는 암호화 키는 공개되고 복호화 키는 비공개로 유지
    - 대칭 암호화는 데이터의 암호화와 복호화에 동일한 퍼블릭 키를 사용
- IPSec은 비대칭 암호화로 보안연결을 설정하고, 대칭 암호화로 전환해 데이터 전송속도를 높임

## IPSec의 작동 방식

1. 발신 컴퓨터는 보안 정책을 확인해 데이터를 전송하는데 IPSec 보호가 필요한지 여부를 확인 
2. IPSec 보호가 필요한 경우 컴퓨터는 수신 컴퓨터로의 보안 IPSec 전송을 시작
3. 두 컴퓨터 모두 보안 연결을 설저아힉 위해 요구사항 협상을 진행 
    1. 이 과정에는 암호화, 인증 및 기타 보안 연결(SA) 파라미터에 대한 상호동의가 포함
4. 컴퓨터들은 암호화된 데이터를 주고받으며 신뢰할 수 있은 소스에서 전송되었는지 확인 
    1. 기본 콘텐츠의 신뢰성을 확인하기 위해 검사를 수행
5. 전송이 완료되거나 세션이 시간초과되면 컴퓨터는 IPSec 연결을 종료함

## IPSec 프로토콜의 종류

- 데이터 패킷은 네트워크 전송을 위해 정보를 포맷하고 준비하는 특정 구조
- 헤더, 페이로드 및 트레일러로 구성
    - 헤더는 데이터 패킷을 올바른 대상으로 라우팅하기 위한 지침 정보가 포함된 선행 섹션
    - 페이로드는 데이터 패킷에 포함된 실제 정보를 나타내는 용어
    - 트레일러는 데이터 패킷의 끝을 나타내기 위해 페이로드의 끝에 추가되는 추가 데이터

### 인증 헤더 (AH)

- 인증헤더(AH) 프로토콜은 발신자 인증 데이터가 포함된 헤더를 추가하고, 권한이 없는 당사자가 수정하지 못하도록 패킷 콘텐츠를 보호
- 수신자에게 원본 데이터 패킷이 조작되었을 가능성을 경고
- 데이터 패킷을 수신할 때 컴퓨터는 페이로드의 암호화 해시 계산 결과라 헤더와 비교해 두 값이 일치하는지 확인
- 암호화 해시는 데이터를 고유한 값으로 요약하는 수학 함수

### 보안 페이로드 캡슐화 (ESP)

- 선택한 IPSec 모드에 따라, 보안 페이로드 캡슐화(ESP) 프로토콜은 전체 IP 패킷 또는 페이로드에 대해서만 암호화를 수행
- ESP는 암호화할 때 데이터 패킷에 헤더와 트레일러를 추가

### Internet Key Exchange (IKE)

- Internet Key Exchange(IKE)는 인터넷에서 두 디바이스 간에 보안 연결을 설정하는 프로토콜
- 두 디바이스 모두 암호화 키 및 알고리즘을 협상하여 후속 데이터 패킷을 송수신하는 보안 연결(SA)을 설정

## IPSec 모드 종류

### 터널

- IPSec 터널 모드는 권한이 없는 당사자로부터의 데이터 보호를 강화하므로, 퍼블릭 네트워크의 데이터를 전송하는 데 적합
- 컴퓨터가 페이로드와 헤더를 포함한 모든 데이터를 암호화하고, 데이터에 새 헤더를 추가

### 전송

- IPSec 전송 모드는 데이터 패킷의 페이로드만 암호화하고 IP 헤더를 원래 형식으로 유지
- 암호화되지 않은 패킷 헤더를 통해 라우터는 각 데이터 패킷의 대상 주소를 식별할 수 있음
- 따라서 IPSec 전송은 두 컴퓨터 간의 직접 연결을 보호하는 경우처럼, 가깝고 신뢰할 수 있는 네트워크에서 사용됨

## IPSec VPN이란?

- VPN 또는 가상 프라이빗 네트워크는 사용자가 익명으로 안전하게 인터넷을 검색할 수 있도록 하는 네트워킹 소프트웨어
- IPSec VPN은 IPSec 프로토콜을 사용하여 인터넷에 암호화된 터널을 생성하는 VPN 소프트웨어이며, 엔드 투 엔드 암호화를 제공함
- 즉, 데이터가 컴퓨터에서 스크램블되고 수신 서버에서 스크램블이 해지됨

### SSL VPN

- SSL은 보안 소켓 계층을 의미하며 웹 트래픽을 보호하는 보안 프로토콜
- SSL VPN은 기본 SSL 프로토콜을 사용하여 네트워크 통신을 암호화하고 보호하는 브라우저 기반 네트워크 보안 서비스

### IPSec VPN과 SSL VPN의 차이

- 두 보안 프로토콜 모두 오픈 시스템 상호 연결(OSI) 모델의 서로 다른 계층에서 작동
- OSI 모델은 컴퓨터가 네트워크에서 데이터를 교환하는 방식의 계층 구조를 정의
- IPSec 프로토콜은 OSI 모델의 중간에 있는 네트워크 및 전송 계층에 적용
- 반면, SSL은 최상위 애플리케이션 계층의 데이터를 암호화 함
- 웹 브라우저에서 SSL VPN에 연결할 수 있지만, IPSec VPN을 사용하려면 별도의 소프트웨어 설치가 필요함