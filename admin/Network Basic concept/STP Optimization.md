# STP 최적화

## STP 포트 상태

- STP가 적용되는 스위치의 포트는 차단(Blocking), 청취(Listening), 학습(Learning), 전송(Forwarding) 상태 중에 하나로 동작
- 차단상태: 스위치의 전원이 들어오면 처음의 모든 포트는 차단상태, 데이터 프레임을 전달하지 않고 BPDU만 수신 가능
- 청취 상태: BPDU를 수신하여 데이터 프레임을 전달하기 전에 네트워크에 루프가 발생했는가 확인
- 학습 상태: MAC 주소를 학습하고 MAC주소 테이블을 구성하며 아직 데이터 프레임은 전달하지 않음.
- 전송 상태: 데이터의 송-수신이 가능한 정상 동작상태를 나타냄

## STP 타이머

- STP 타이머는 스위치 포트가 하나의 상태에서 다른 상태로 변경될 때 동작
- 맥스에이지 타이머: 루트 브리지의 손실을 감지하는 타이머로 20초가 기본값, 2초마다 오는 BPDU가 20초가 지나도 오지 않을 경우 루트 브리지를 다시 선정
- 전송 지연 타이머: 네트워크 토폴로지에 대한 정보를 수집하는데 필요한 시간 정의

## STP 수렴시간 문제점

- STP를 사용하는 스위치 네트워크에 스위치가 추가되거나 링크의 장애로 인해 변화가 발생할 경우, 즉, 토폴로지 등이 변경될 경우 스위치 네트워크는 재구성되며, 이 때 정상 상태까지 도달하는데 소요되는 시간을 수렴시간(convergence time) 이라고 함
- STP의 수렴시간은 STP 타이머에 의해 30~50초가 소요되는데, 이 시간동안 네트워크는 다운 상태에 있는 것과 마찬가지 이며 네트워크에서 수많은 데이터가 유실되거나 전송이 불가능한 상태가 됨

## 포트패스트

- 스위치에 PC나 서버 등의 장비를 연결할 경우 수렴시간 없이 바로 전송 상태로 만들어주는 기술로 해당 포트에 STP가 실행되지 않도록 함
- 포트패스트를 설정한 스위치 포트에 다른 스위치를 연결하면 루프가 발생할 수 있으므로 PC나 서버만을 연결해야 함
- 포트패스트는 트렁크 포트가 아닌 액세스 포트에만 설정

## 업링크 패스트

- 루프 프트로 자신과 직접 연결된 트렁크 링크에 장애가 발생하였을 경우 차단 상태였던 포트를 바로 전송 상태로 만들어주는 기술(포트패스트와 유사한 특징)
- 차단된 포트를 가지고 있는 끝단의 스위치에 설정해야만 정상 동작
- 차단 포트가 없는 스위치에서는 설정해도 아무 효과가 없음

## 백본패스트

- 자신과 직접 연결되지 않은 간접 링크에 장애가 발생하였을 경우 차단 상태였던 스위치 포트를 바로 청취 상태로 만들어주는 기술
- 업링크패스트와의 차이점은 장애를 겪은 스위치가 차단포트를 가진 스위치에게 전송 상태로 변경시키기를 요청한다는 것
- 백본패스트는 모든 스위치에 설정

## STP 수렴 시간 조정

- 스위치 네트워크의 토폴로지를 고려하여 헬로(Hello), 맥스에이지(Maxage), 전송 지연(Forward Delay)타이머를 조정해서 수렴시간을 줄일 수 있음
- 2대의 스위치가 데이터를 전달하기 위해 거쳐가는 최대 스위치 수를 의미하는 Diameter를 고려하여 권장 타이머 값을 준수하는 것이 안전함
- 타이머 조정은 루트 브리지에서 설정해야 모든 스위치에 적용됨
- commands
    
    > 포트패스트 설정 명령어
    > 
    - 전역 설정 (Global Configuration) 모드에서 설정
    - 인터페이스 모드에서 설정
    
    > 업링크패스트 설정 명령어
    > 
    - 전역 설정(Global Configuration)모드에서 설정
    
    > 백본패스트 설정 명령어
    > 
    - 전역 설정(Global Configuration)모드에서 설정
    
    > 타이머 조정 설정 명령어
    > 
    - 헬로 타이머 조정
    - 맥스에이지 타이머 조정
    - 전송 지연 타이머 조정